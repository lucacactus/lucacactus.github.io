<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="John Doe">





<title>Spring | Hexo</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Qiny&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Qiny&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Spring</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">John Doe</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">April 11, 2021&nbsp;&nbsp;16:14:32</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Spring概述"><a href="#Spring概述" class="headerlink" title="Spring概述"></a>Spring概述</h1><h2 id="1-认识框架"><a href="#1-认识框架" class="headerlink" title="1. 认识框架"></a>1. 认识框架</h2><ul>
<li><p>spring全家桶：</p>
<ul>
<li>spring</li>
<li>springmvc</li>
<li>spring boot</li>
<li>spring cloud</li>
</ul>
</li>
<li><p>spring：出现是在2002左右，解决企业开发的难度。减轻对项目模块之间的管理，类和类之间的管理，帮助开发人员创建对象，管理对象之间的关系。spring核心技术：ioc、aop。能实现模块之间，类之间的解耦合。</p>
</li>
<li><p>依赖：类A中使用类B的属性或者方法，叫做类A依赖类B。</p>
</li>
<li><p>官网：<a target="_blank" rel="noopener" href="https://spring.io/">https://spring.io</a></p>
</li>
</ul>
<h2 id="2-框架内部模块"><a href="#2-框架内部模块" class="headerlink" title="2. 框架内部模块"></a>2. 框架内部模块</h2><ul>
<li>Spring优点？<ol>
<li>轻量<ul>
<li>Spring框架使用的 jar 都比较小，一般在1M以下或者击败kb。Spring核心功能的所需的jar总共在3M左右。</li>
<li>Spring框架运行占用的资源少，运行效率高。不依赖其他jar。</li>
</ul>
</li>
<li>针对接口编程，解耦合<ul>
<li>Spring提供了Ioc控制翻转，有容器管理对象，对象的依赖关系。原来在程序代码中的对象创建方式，现在由容器完成。对象之间的依赖解耦合。</li>
</ul>
</li>
<li>AOP 编程的支持<ul>
<li>通过Spring提供的AOP功能，方便进行面向切面的编程，许多不容易用传统OOP实现的功能可以通过AOP轻松应付。</li>
<li>在Spring中，开发人员可以从繁杂的事务管理代码中解脱处理，通过声明式的方式灵活的进行事务的管理，提高开发效率和质量。</li>
</ul>
</li>
<li>方便集成各种优秀框架<ul>
<li>Spring不排斥各种优秀的开源框架，相反Spring可以降低各种框架的使用难度，Spring提供了对各种优秀框架（如Struts、Hibernate、MyBatis）等的直接支持。简化框架的使用。Spring像插线板一样，其他框架是插头，可以容易的组合到一起。需要使用哪个框架，就把这个插头放入插线板。不需要可以轻易地移除。</li>
</ul>
</li>
</ol>
</li>
</ul>
<h1 id="IOC控制反转"><a href="#IOC控制反转" class="headerlink" title="IOC控制反转"></a>IOC控制反转</h1><h2 id="1-IOC概念"><a href="#1-IOC概念" class="headerlink" title="1. IOC概念"></a>1. IOC概念</h2><ul>
<li><p>框架怎么学：框架是一个软件， 其它人写好的软件。</p>
<ol>
<li>知道枢架能做什么，mybatis–访 问数据库，对 表中的数据执行增删改查。</li>
<li>框架的语法，框架要完成- 一个功能，需要一定的步骤支持的，</li>
<li>框架的内部实现，框架 内部怎么做。原理是什么。</li>
<li>通过学习，可以实现一个框架。</li>
</ol>
</li>
<li><p>spring的第一个核心功能IOC</p>
<ul>
<li><p>IOC（Inversion of Control）：控制反转，是一个理论，概念，思想。</p>
</li>
<li><p>描述的：把对象的创建，赋值，管理工作都交给代码之外的容器实现，也就是对象的创建是有其它外部资源完成。</p>
</li>
<li><p>控制：创建对象，对象的属性赋值，对象之间的关系管理。</p>
</li>
<li><p>正转：由开发人员在代码中，使用new构造方法创建对象，开发 人员主动管理对象。</p>
</li>
<li><p>反转：把原来的开发人员管理，创建对象的权限转移给代码之外的容器实现。由容器代替开发人员管理对象、创建对象、给属性赋值。</p>
</li>
<li><p>容器：是一个服务器软件，一个框架（Spring）</p>
</li>
<li><p>为什么要使用IOC：目的就是减少对代码的改动，也能实现不同的功能。实现解耦合。</p>
</li>
<li><p>java中创建对象的方式：</p>
<ol>
<li>构造方法，new Student();</li>
<li>反射</li>
<li>序列化</li>
<li>克隆</li>
<li>ioc：容器创建对象。</li>
<li>动态代理</li>
</ol>
</li>
<li><p>IOC的体现</p>
<ul>
<li><p>servlet </p>
<ol>
<li><p>:创建类 继承Httpservelt</p>
</li>
<li><p>在web.xml 注册servlet，使用</p>
<p>&lt;servlet-nane&gt; myservlet &lt;/servlet-nano&gt;<br>&lt;servelt-class&gt;xxx .MyServ1et1&lt;/servlet-class&gt;</p>
</li>
<li><p>没有创建servlet对象， 没有 MyServlet myservlet = new MnyServlet();</p>
</li>
<li><p>Servlet 是Tomcat服务器它能你创建的。Tomcat也称为容器。Tomcat作为容器：里面存放的有Servlet对象，Listener ，Pilter对象。</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p>IOC的技术实现</p>
<ul>
<li>DI（Dependency Injection）：依赖注入，我们只需要在程序中提供要使用的对象名称就可以，至于对象如何在容器中创建，赋值，查找都有容器内部实现。</li>
<li>DI是IOC的技术实现。</li>
</ul>
</li>
<li><p>spring是使用的di实现了IOC的功能，spring底层创建对象，使用的是反射机制。</p>
</li>
<li><p>spring是一一个容器，管理对象，给属性赋值，底层是反射创建对象。</p>
</li>
</ul>
</li>
</ul>
<h2 id="2-第一个例子"><a href="#2-第一个例子" class="headerlink" title="2. 第一个例子"></a>2. 第一个例子</h2><ul>
<li><p>使用的IOC，有Spring创建对象</p>
</li>
<li><p>实现的步骤：</p>
<ol>
<li>创建maven项目</li>
<li>加入maven依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 插件 --&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建类（接口和他的实现类）：和没有使用框架一样，就是普通的类。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SomeService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSome</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 普通实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeServiceImpl</span> <span class="keyword">implements</span> <span class="title">SomeService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSome</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了SomeServiceImpl的doSome()方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SomeService service = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line">    service.doSome();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 执行结果：</span></span><br><span class="line"><span class="comment">	执行了SomeServiceImpl的doSome()方法</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>创建Spring需要使用的配置文件。声明类的信息，这些类有Spring创建和管理</p>
<p>Spring的配置文件</p>
<ol>
<li>beans：是根标签，spring把java对象称为bean。</li>
<li>spring-beans.xsd：是约束文件，和mybatis中的dtd文件是一样的。</li>
</ol>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 告诉spring创建对象</span></span><br><span class="line"><span class="comment">        声明bean，就是告诉spring要创建某个类的对象</span></span><br><span class="line"><span class="comment">        id：对象的自定义名称，唯一值。spring通过这个名称找到对象</span></span><br><span class="line"><span class="comment">        class：类的全限定名称（不能是接口，因为Spring是反射机制创建对象，必须使用类）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        spring就完成SomeService someService = new SomeServiceImpl();</span></span><br><span class="line"><span class="comment">        spring是吧创建好的对象放入到map中，spring框架有一个map是存放对象的</span></span><br><span class="line"><span class="comment">            springMap.put(id的值，对象);</span></span><br><span class="line"><span class="comment">        一个bean标签声明一个对象</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;someService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.service.impl.SomeServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>测试Spring创建对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 使用spring容器创建的对象</span></span><br><span class="line">    <span class="comment">// 1. 指定spring配置文件的名称</span></span><br><span class="line">    String config = <span class="string">&quot;beans.xml&quot;</span>;</span><br><span class="line">    <span class="comment">// 2. 创建表示spring容器的对象，ApplicationContext</span></span><br><span class="line">    <span class="comment">// ApplicationContext就是表示Spring的容器，通过容器获取对象了</span></span><br><span class="line">    <span class="comment">// ClassPathXmlApplicationContext：表示从类路径中加载spring的配置文件</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(config);</span><br><span class="line">    <span class="comment">// 3. 从容器中获取某个对象，你要调用对象的方法。</span></span><br><span class="line">    SomeService service = (SomeService) context.getBean(<span class="string">&quot;someService&quot;</span>);</span><br><span class="line">    <span class="comment">// 4. 使用spring创建好的对象</span></span><br><span class="line">    service.doSome();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 运行结果：</span></span><br><span class="line"><span class="comment">	执行了SomeServiceImpl的doSome()方法</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-Spring创建对象的时机"><a href="#3-Spring创建对象的时机" class="headerlink" title="3. Spring创建对象的时机"></a>3. Spring创建对象的时机</h2><ul>
<li><p>spring默认创建对象的时间：在创建spring的容器时，会创建配置文件中的所有的对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此时就已经获取到了SomeServiceImpl对象</span></span><br><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(config);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 若对SomeServiceImpl的无参构造方法进行修改</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SomeServiceImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;SomeServiceImpl的无参构造方法&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;someService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.service.impl.SomeServiceImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;someService1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.service.impl.SomeServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 再次运行测试，可得</span></span><br><span class="line"><span class="comment">	SomeServiceImpl的无参构造方法 // 第一个someService被创建</span></span><br><span class="line"><span class="comment">    SomeServiceImpl的无参构造方法 // 第二个someService被创建</span></span><br><span class="line"><span class="comment">    执行了SomeServiceImpl的doSome()方法 // 调用了第一个someService的doSome</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-获取Spring容器中java对象的信息"><a href="#4-获取Spring容器中java对象的信息" class="headerlink" title="4. 获取Spring容器中java对象的信息"></a>4. 获取Spring容器中java对象的信息</h2><ul>
<li>对象的数量</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用Spring提供的方法，获取容器中定义的对象的数量</span></span><br><span class="line">System.out.println(context.getBeanDefinitionCount());</span><br><span class="line"><span class="comment">// 2：表示容器里有两个对象</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对象的名称</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 容器中每个定义的对象的名称</span></span><br><span class="line">String[] names = context.getBeanDefinitionNames();</span><br><span class="line">Arrays.asList(names).forEach(System.out::println);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    someService</span></span><br><span class="line"><span class="comment">    someService1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="5-创建非自定义对象"><a href="#5-创建非自定义对象" class="headerlink" title="5. 创建非自定义对象"></a>5. 创建非自定义对象</h2><blockquote>
<p>Spring既能创建自己定义的对象，也可以创建本身已有的对象</p>
</blockquote>
<ul>
<li>bean配置（以java.util.Date为例）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试容器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test04</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(</span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;beans.xml&quot;</span>)</span><br><span class="line">        	.getBean(<span class="string">&quot;myDate&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	Tue Mar 30 22:02:24 CST 2021</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h1 id="基于XML的依赖注入"><a href="#基于XML的依赖注入" class="headerlink" title="基于XML的依赖注入"></a>基于XML的依赖注入</h1><blockquote>
<p>在spring的配置文件中，给java对象的属性赋值。</p>
<p>di：依赖注入，表示创建对象，给属性赋值</p>
<ul>
<li>di的实现语法有两种：<ol>
<li>在spring的配置文件中，使用标签和属性来完成，叫做基于XML的di实现。</li>
<li>使用spring中的注解，完成属性赋值，叫做基于注解的id实现。</li>
</ol>
</li>
<li>di的语法分类<ol>
<li>set注入(设置注入) : spring调用类的set方法 ，在set方法可以实现属性的赋值。80%左右都是使用的set注入。</li>
<li>构造注入，spring调用类的有参数构造方法，创建对象。在构造方法中完成赋值。</li>
</ol>
</li>
</ul>
</blockquote>
<h2 id="1-设值注入"><a href="#1-设值注入" class="headerlink" title="1. 设值注入"></a>1. 设值注入</h2><h3 id="1-0-没有设值的情况"><a href="#1-0-没有设值的情况" class="headerlink" title="1.0 没有设值的情况"></a>1.0 没有设值的情况</h3><ul>
<li> 实体类Student</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">// 省略setter 和toString()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>beans</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明student对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myStudent&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.Student&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>test</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = </span><br><span class="line">    <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="comment">// 从容器中获取Student对象</span></span><br><span class="line">Student student = (Student) context.getBean(<span class="string">&quot;myStudent&quot;</span>);</span><br><span class="line">System.out.println(student);<span class="comment">// Student&#123;name=&#x27;null&#x27;, age=null&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-1-简单类型的set注入（设值注入）"><a href="#1-1-简单类型的set注入（设值注入）" class="headerlink" title="1.1 简单类型的set注入（设值注入）"></a>1.1 简单类型的set注入（设值注入）</h3><blockquote>
<p>注入：就是赋值的意思</p>
<p>简单类型：spring中规定java的基本数据类型和String都是简单类型。</p>
<p>spring 调用类的set方法，你可以在set方法中完成属性赋值。</p>
</blockquote>
<ul>
<li>beans</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 简单类型的set注入</span></span><br><span class="line"><span class="comment">    &lt;property name=&quot;属性名&quot; value=&quot;此属性的值&quot; /&gt;</span></span><br><span class="line"><span class="comment">    一个property只能给一个属性赋值</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>test</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    <span class="comment">// 从容器中获取Student对象</span></span><br><span class="line">    Student student = (Student) context.getBean(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    System.out.println(student);<span class="comment">// Student&#123;name=&#x27;张三&#x27;, age=20&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-单元测试junit"><a href="#1-2-单元测试junit" class="headerlink" title="1.2 单元测试junit"></a>1.2 单元测试junit</h3><blockquote>
<p>junit：单元测试，一个工具类库，做测试方法使用的。<br>单元：指定的是方法，一个类中有很多方法，一个方法称为单元。</p>
</blockquote>
<ul>
<li><p>使用单元测试</p>
<ol>
<li>加入junit依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>创建测试作用的类：叫做测试类。<code>src/test/java</code>下创建类</p>
</li>
<li><p>测试方法</p>
<ol>
<li>public方法</li>
<li>没有返回值（返回值为void）</li>
<li>方法名称自定义，建议名称是test + 你要测试方法名称</li>
<li>方法没有参数</li>
<li>方法的上面加入@Test，这样的方法是可以单独执行的。不需要使用main方法。</li>
</ol>
</li>
</ol>
</li>
</ul>
<h3 id="1-3-设值注入的注意事项"><a href="#1-3-设值注入的注意事项" class="headerlink" title="1.3 设值注入的注意事项"></a>1.3 设值注入的注意事项</h3><ul>
<li><p>spring进行设值注入时会先调用实体类的无参数构造方法，再调用set方法。</p>
</li>
<li><p>实体类必须要有相应的set方法。</p>
<ul>
<li>比如property中name为email，实体类中必须要有setEmail这个方法。</li>
</ul>
</li>
<li><p>set方法里可以不进行赋值。</p>
</li>
<li><p>也可以没有对应的属性。</p>
<ul>
<li>比如property中name为email，实体类中不一定要有email这个属性。</li>
<li>也就是说，只要这个类有setXxx方法，spring就可以用bean来调用。</li>
</ul>
</li>
</ul>
<h3 id="1-4-引用类型的设值注入"><a href="#1-4-引用类型的设值注入" class="headerlink" title="1.4 引用类型的设值注入"></a>1.4 引用类型的设值注入</h3><ul>
<li>实体类School</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">School</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="comment">// 省略setter和toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Student添加school属性</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> School school;</span><br><span class="line">    <span class="comment">// 省略setter和toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>beans</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用类型的set注入：spring调用类的set方法</span></span><br><span class="line"><span class="comment">    &lt;property name=&quot;属性名称&quot; ref=&quot;bean的id&quot;/&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;lisi&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;李四&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;23&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;school&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;tsingHua&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;tsingHua&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.School&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;清华大学&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">value</span>=<span class="string">&quot;北京&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>test</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context =</span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    System.out.println(context.getBean(<span class="string">&quot;lisi&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Student&#123;name=&#x27;李四&#x27;, age=23, school=School&#123;name=&#x27;清华大学&#x27;, address=&#x27;北京&#x27;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-构造注入"><a href="#2-构造注入" class="headerlink" title="2. 构造注入"></a>2. 构造注入</h2><ul>
<li>创建有参数构造方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name, Integer age, School school)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.school = school;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>beans</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 构造注入：spring调用类有参数构造方法，在创建对象的同时，在构造方法中给属性赋值。</span></span><br><span class="line"><span class="comment">    构造注入使用&lt;constructor-arg&gt; 标签</span></span><br><span class="line"><span class="comment">    &lt;constructor-arg&gt;标签: 一个&lt;constructor-arg&gt;表示构造方法一个参数。</span></span><br><span class="line"><span class="comment">    &lt;constructor-arg&gt;标签属性:</span></span><br><span class="line"><span class="comment">        name：   表示构造方法的形参名</span></span><br><span class="line"><span class="comment">        index：  表示构造方法的参数的位置，参数从左往右位置是0，1, 2的顺 序</span></span><br><span class="line"><span class="comment">        value：  构造方法的形参类型是简单类型的，使用value</span></span><br><span class="line"><span class="comment">        ref：    构造方法的形参类型是引用类型的，使用ref</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;wangwu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;王五&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;school&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;tsingHua&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 或者 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;wangwu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;王五&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;tsingHua&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 甚至可以直接省略index：条件就是要与构造方法非参数顺序一致 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;wangwu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;王五&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;tsingHua&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 当然，用name可读性更高 --&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>test</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test04</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context =</span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    System.out.println(context.getBean(<span class="string">&quot;wangwu&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Student&#123;name=&#x27;王五&#x27;, age=20, school=School&#123;name=&#x27;清华大学&#x27;, address=&#x27;北京&#x27;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-引用类型的自动注入"><a href="#3-引用类型的自动注入" class="headerlink" title="3. 引用类型的自动注入"></a>3. 引用类型的自动注入</h2><blockquote>
<p>spring框架根据某些规则可以给引用类型赋值。不用你再给引用类型赋值了。</p>
<p>使用的规则常用的是byName，byType</p>
</blockquote>
<h3 id="3-1-byName（按名称注入）"><a href="#3-1-byName（按名称注入）" class="headerlink" title="3.1 byName（按名称注入）"></a>3.1 byName（按名称注入）</h3><ul>
<li><p>java类中引用类型的属性名和spring容器中(配置文件) &lt;bean&gt;的id名称一样，且数据类型是一致的，这样的容器中的bean，spring能够赋值給引用类型。</p>
</li>
<li><p>语法：**<code>\&lt;bean id=&quot;xx&quot; class=&quot;yyy&quot; autowire=&quot;byName&quot;\&gt;</code>**</p>
</li>
<li><p>beans</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 测试自动注入 - - byName --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;zhaoliu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.Student&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;赵六&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;24&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- bean的id要和实体类的属性名一致 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;school&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.School&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;同济大学&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上海&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Test</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    Student student = (Student) context.getBean(<span class="string">&quot;zhaoliu&quot;</span>);</span><br><span class="line">    System.out.println(student);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Student&#123;name=&#x27;赵六&#x27;, age=24, school=School&#123;name=&#x27;同济大学&#x27;, address=&#x27;上海&#x27;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-byType（按类型注入）"><a href="#3-2-byType（按类型注入）" class="headerlink" title="3.2 byType（按类型注入）"></a>3.2 byType（按类型注入）</h3><ul>
<li><p>java中引用类型的数据类型和spring容器（配置文件）中&lt;bean&gt;的class属性是同源关系的，这样的bean能够赋值给引用类型。</p>
<ul>
<li>同源关系：同源就是一类的意思<ol>
<li>java类中引用类型的数据类型和&lt;bean&gt;的class的值是一样的。</li>
<li>java类中引用类型的数据类型和&lt;bean&gt;的class的值是父子类关系的。</li>
<li>java类中引用类型的数据类型和&lt;bean&gt;的class的值是接口和实现关系的。</li>
</ol>
</li>
</ul>
</li>
<li><p>beans</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bean的id要和实体类的属性名一致 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;tongji&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.School&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;bean id=&quot;school&quot; class=&quot;ctgu.qiny.entity.School&quot;&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;同济大学&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上海&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 测试自动注入 - - byType --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;zhouqi&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.Student&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;周琪&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;23&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- bean的class不一定要与实体类的属性一致，但一个配置文件中只能有一个这个属性（或者与这个属性同源的）的bean --&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>test</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    Student student = (Student) context.getBean(<span class="string">&quot;zhouqi&quot;</span>);</span><br><span class="line">    System.out.println(student);</span><br><span class="line">    <span class="comment">// Student&#123;name=&#x27;周琪&#x27;, age=23, school=School&#123;name=&#x27;同济大学&#x27;, address=&#x27;上海&#x27;&#125;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-多配制文件"><a href="#3-3-多配制文件" class="headerlink" title="3.3 多配制文件"></a>3.3 多配制文件</h3><ul>
<li><p>多配制文件的优势</p>
<ol>
<li>每个文件的大小比一个文件要小很多，效率高。</li>
<li>避免多人竞争带来的冲突</li>
</ol>
</li>
<li><p>如果你的项目有多个模块（相关的功能在一起），一个模块一个配置文件，例如：</p>
<ol>
<li>学生考勤模块一个配置文件</li>
<li>学生成绩模块一个配置文件</li>
</ol>
</li>
<li><p>多文件的分配方式</p>
<ol>
<li>按功能模块，一个模块一个配置文件</li>
<li>按类的功能，数据库相关的配置一个配置文件，做事务的功能一个配置文件，做service功能的一个配置文件等。</li>
</ol>
</li>
<li><p>使用多配置文件</p>
<ol>
<li>spring-student.xml</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- student模块所有bean的声明 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>spring-school.xml</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- school模块所有bean的声明，school模块的配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hangkong&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.entity.School&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;航空大学&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">value</span>=<span class="string">&quot;北京海淀区&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>spring-total.xml</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-total表示主配置文件：用来包含其他的配置文件，一般不用来定义对象。 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 语法：&lt;import resource=&quot;其他配置文件的路径&quot;/&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 关键字：&quot;classpath:&quot;表示类路径（class文件所在的目录） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在spring配置文件中要指定其他文件的位置，需要使用classpath，告诉spring到哪去加载读取文件。 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:spring-student.xml&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:spring-school.xml&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 好像不能这样子写了，会报错No bean named &#x27;xxx&#x27; available --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 包含关系的配置文件中，可以使用通配符（*表示任意字符） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;import resource=&quot;classpath:spring-*.xml&quot; /&gt; --&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>test</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;total.xml&quot;</span>);</span><br><span class="line">    <span class="comment">// 从容器中获取Student对象</span></span><br><span class="line">    Student student = (Student) context.getBean(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    System.out.println(student);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Student&#123;name=&#x27;张三&#x27;, age=30, school=School&#123;name=&#x27;航空大学&#x27;, address=&#x27;北京海淀区&#x27;&#125;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="基于注解的依赖注入"><a href="#基于注解的依赖注入" class="headerlink" title="基于注解的依赖注入"></a>基于注解的依赖注入</h1><blockquote>
<p>通过注解完成java对象创建，属性赋值</p>
</blockquote>
<ul>
<li><p>使用注解的步骤：</p>
<ol>
<li><p>加入maven的依赖 spring-context，在你加入spring-context的同时，间接加入spring-aop的依赖。</p>
<p>使用注解必须使用spring-aop依赖。</p>
</li>
<li><p>在类中加入spring的注解（多个不同功能的注解）</p>
</li>
<li><p>在spring的配置文件中，加入一个组件扫描器的标签，说明注解在你的项目中的位置。</p>
</li>
</ol>
</li>
<li><p>学习的注解</p>
<ol>
<li><p>@Component</p>
</li>
<li><p>@Repository</p>
</li>
<li><p>@Service</p>
</li>
<li><p>@Controller</p>
</li>
<li><p>@Value</p>
</li>
<li><p>@Autowire</p>
</li>
<li><p>@Resource</p>
</li>
</ol>
</li>
</ul>
<h2 id="1-Component注解的使用"><a href="#1-Component注解的使用" class="headerlink" title="1. @Component注解的使用"></a>1. @Component注解的使用</h2><ul>
<li><p>通过spring的注解完成java对象的创建，属性。代替xml文件</p>
</li>
<li><p>实现步骤：</p>
<ol>
<li><p>加入依赖</p>
</li>
<li><p>创建里，在类中加入注解</p>
</li>
<li><p>创建spring的配置文件</p>
<p>声明组件扫描器的标签，知名注解在你的项目中的位置。</p>
</li>
<li><p>使用注解创建的对象，创建容器ApplicationContext</p>
</li>
</ol>
</li>
<li><p>实体类</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Component：创建对象的，等同于&lt;bean&gt;的功能</span></span><br><span class="line"><span class="comment"> * * 属性：	value 就是对象的名称，也就是bean的id值，</span></span><br><span class="line"><span class="comment"> * * 		value的值是惟一的，创建的对象在整个spring容器中就一个</span></span><br><span class="line"><span class="comment"> * * 位置：	在类的上面。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @Component(value = &quot;myStudent&quot;)等同于</span></span><br><span class="line"><span class="comment"> * * &lt;bean id=&quot;myStudent&quot; class=&quot;ctgu.qiny.entity.Student&quot; /&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用value属性，指定对象的名称</span></span><br><span class="line"><span class="comment">// @Component(value = &quot;myStudent&quot;)</span></span><br><span class="line"><span class="comment">// value也可以省略</span></span><br><span class="line"><span class="comment">// @Component(&quot;myStudent&quot;)// 指定了bean的id</span></span><br><span class="line"><span class="comment">// 不指定id时，容器默认给一个id</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">// id为类的首字母小写</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在配置文件中定义组件扫描器</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明组件扫描器（component-scan），组件就是java对象 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- * 	base-package：指定注解在你的项目中的包名 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- *	component-scan工作方式：spring会扫描遍历base-package指定的包 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- *		把包中和子包中的所有类，找到类中的注解，按照注解的功能创建对象，或给属性赋值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;ctgu.qiny.entity&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    <span class="comment">// Student student = (Student) context.getBean(&quot;myStudent&quot;);</span></span><br><span class="line">    Student student = (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">    System.out.println(student);</span><br><span class="line">    <span class="comment">// Student [name=null, age=null]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>spring中和@Component功能一致，创建对象的注解还有：</p>
<ol>
<li>@Repository（用在持久层类的上面）：放在dao的实现类上面，表示创建dao对象，dao对象是能访问数据库的。</li>
<li>@Service（用在业务层类的上面）：放在service的实现类上面，创建service对象，service对象是做业务处理，可以有事务等功能的。</li>
<li>@Controller（用在控制器的上面）：放在控制器（处理器）类的上面，创建控制器对象的，孔梅花之气对象，能够接收用户提交的参数，显示请求的处理结果。</li>
<li>以上三个注解的使用语法和Component一样。都能创建对象，但是这三个注解还有额外的功能。是给项目的对象分层的。</li>
</ol>
</li>
<li><p>指定多个包的方式</p>
<ol>
<li>第一种方式：使用多次组件扫描器，指定不同的包。</li>
<li>第二种方式：使用分隔符（;或,）分隔多个包名。</li>
<li>第三种方式：指定父包。</li>
</ol>
</li>
</ul>
<h2 id="2-简单类型的属性赋值"><a href="#2-简单类型的属性赋值" class="headerlink" title="2. 简单类型的属性赋值"></a>2. 简单类型的属性赋值</h2><ul>
<li><p>@Value：简单类型的属性赋值</p>
<ul>
<li>属性：value 是string类型的， 表示简单类型的属性值。</li>
<li>位置：<ol>
<li>在属性定义的上面，无需set方法，推荐使用。</li>
<li>在set方法的上面</li>
</ol>
</li>
</ul>
</li>
<li><p>实体类</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">// id为类的小写</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value(value = &quot;张飞&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@Value(value = &quot;29&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">// 省略toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>再次执行test类，可得</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student [name=张飞, age=29]</span><br></pre></td></tr></table></figure>

<h2 id="3-引用类型-Autowired"><a href="#3-引用类型-Autowired" class="headerlink" title="3. 引用类型@Autowired"></a>3. 引用类型@Autowired</h2><h3 id="3-1-基本使用"><a href="#3-1-基本使用" class="headerlink" title="3.1 基本使用"></a>3.1 基本使用</h3><ul>
<li>spring框架提供的注解，实现引用类型的赋值。</li>
<li>spring中通过注解给引用类型赋值，使用的是自动注入原理，支持byName，byType。</li>
<li>@Autowired：默认使用的是byType自动注入。</li>
<li>位置：<ul>
<li>在属性定义的上面，无需set方法，推荐使用</li>
<li>在set方法的上面</li>
</ul>
</li>
<li>School实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">School</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value(&quot;清华大学&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@Value(&quot;上海&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="comment">// 省略toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Student实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(value = &quot;张飞&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@Value(value = &quot;29&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> School school;</span><br><span class="line">    <span class="comment">// 省略toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>再次执行测试</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student [name=张飞, age=29, school=School&#123;name=&#x27;清华大学&#x27;, address=&#x27;上海&#x27;&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="3-2-Autowired的byName"><a href="#3-2-Autowired的byName" class="headerlink" title="3.2 @Autowired的byName"></a>3.2 @Autowired的byName</h3><ul>
<li><p>如果要使用byName方式，需要做的是: </p>
<ol>
<li>在属性上面加入@Autowired</li>
<li>在属性上面加入@Qualifier(value= “bean的id”)，表示使用指定名称的bean完成赋值。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个注解没有先后顺序</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;mySchool&quot;)</span></span><br><span class="line"><span class="keyword">private</span> School school;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取名为&quot;mySchool&quot;的引用类型的数据</span></span><br><span class="line"><span class="meta">@Component(&quot;mySchool&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">School</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-3-Autowired的required属性"><a href="#3-3-Autowired的required属性" class="headerlink" title="3.3 @Autowired的required属性"></a>3.3 @Autowired的required属性</h3><ul>
<li>属性：required， 是一个boolean类型的，默认true<ul>
<li>required=true：表示引用类型赋值失败，程序报错，并终止执行。</li>
<li>required=false：引用类型如果赋值失败，程序正常执行 ，引用美型Enull</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired(required = false)</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;mySchool-1&quot;)</span></span><br><span class="line"><span class="keyword">private</span> School school;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行时如果没有名为mySchool-1的bean就不会报错，而会显示</span></span><br><span class="line"><span class="comment">// Student [name=张飞, age=29, school=null]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>推荐使用required=true</p>
</blockquote>
<h2 id="4-引用类型Resource"><a href="#4-引用类型Resource" class="headerlink" title="4. 引用类型Resource"></a>4. 引用类型Resource</h2><ul>
<li><p>来自jdk中的注解，spring框架提供了对这个注解的功能支持，可以使用它给引用类型赋。</p>
<p>使用的也是自动注入原理，支byName、byType。默认是byName</p>
</li>
<li><p>位置：</p>
<ul>
<li>在属性定义的上面，无需set方法，推荐使用。</li>
<li>在set方法的上面</li>
</ul>
</li>
<li><p>默认是byName：先使用byName自动注入，如果byName赋值失败，再使用byType</p>
</li>
<li><p>@Resource只使用byName方式，需要增加个属性 name。name的值是bean的id (名称)</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只使用byName的方式</span></span><br><span class="line"><span class="meta">@Resource(name = &quot;mySchool&quot;)</span></span><br><span class="line"><span class="keyword">private</span> School school;</span><br></pre></td></tr></table></figure>

<h2 id="5-xml和注解方式的对比"><a href="#5-xml和注解方式的对比" class="headerlink" title="5. xml和注解方式的对比"></a>5. xml和注解方式的对比</h2><p>变化多的用xml。</p>
<p>变化不多的用注解。</p>
<h1 id="AOP-面向切面编程"><a href="#AOP-面向切面编程" class="headerlink" title="AOP 面向切面编程"></a>AOP 面向切面编程</h1><h2 id="1-动态代理"><a href="#1-动态代理" class="headerlink" title="1. 动态代理"></a>1. 动态代理</h2><ul>
<li>动态代理的实现方式常用的有两种：使用JDK的Proxy，与通过CGLIB生成代理。</li>
</ul>
<h3 id="1-1-JDK动态代理"><a href="#1-1-JDK动态代理" class="headerlink" title="1.1 JDK动态代理"></a>1.1 JDK动态代理</h3><ul>
<li>Jdk的动态要求目标对象必须实现接口，这是java设计上的要求。</li>
<li>从jdk1.3以来，java 语言通过java.lang.reflect包提供三个类支持代理模式Proxy, Method 和InovcationHandler。</li>
</ul>
<h3 id="1-2-CGLIB-动态代理-了解"><a href="#1-2-CGLIB-动态代理-了解" class="headerlink" title="1.2 CGLIB 动态代理(了解)"></a>1.2 CGLIB 动态代理(了解)</h3><ul>
<li>CGLIB（Code Generation Library）是一个开源项目。是一个强大的，高性能，高质量的Code生成类库，它可以在运行期扩展Java类与实现Java 接口。它广泛的被许多AOP的框架使用，例如Spring AOP。</li>
<li>使用JDK 的Proxy 实现代理，要求目标类与代理类实现相同的接口。若目标类不存在接口，则无法使用该方式实现。但对于无接口的类，要为其创建动态代理，就要使用CGLIB来实现。</li>
<li>CGLIB代理的生成原理是生成目标类的子类，而子类是增强过的，这个子类对象就是代理对象。所以，使用CGLIB生成动态代理，要求目标类必须能够被继承，即不能是final的类。</li>
<li>CGLIB经常被应用在框架中，例如Spring ，Hibernate等。cglib 的代理效率高于Jdk。项目中直接使用动态代理的地方不多。一般都使用框架提供的功能。</li>
</ul>
<h3 id="1-3-业务方法增加功能"><a href="#1-3-业务方法增加功能" class="headerlink" title="1.3 业务方法增加功能"></a>1.3 业务方法增加功能</h3><ul>
<li>原始的业务逻辑代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSome</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 真正的业务逻辑代码</span></span><br><span class="line">    System.out.println(<span class="string">&quot;执行业务方法doSome&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doOther</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 真正的业务逻辑代码</span></span><br><span class="line">    System.out.println(<span class="string">&quot;执行业务方法doOther&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>项目运行一段时间之后，又添加的新的需求</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSome</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//项目运行一段时间，又有新的需求：在方法执行前打印运行时间</span></span><br><span class="line">    System.out.println(<span class="string">&quot;方法的执行时间&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 真正的业务逻辑代码</span></span><br><span class="line">    System.out.println(<span class="string">&quot;执行业务方法doSome&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//项目运行一段时间，又有新的需求：在方法执行后提交事务</span></span><br><span class="line">    System.out.println(<span class="string">&quot;方法执行完毕后，提交事务&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doOther</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//项目运行一段时间，又有新的需求：在方法执行前打印运行时间</span></span><br><span class="line">    System.out.println(<span class="string">&quot;方法的执行时间&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 真正的业务逻辑代码</span></span><br><span class="line">    System.out.println(<span class="string">&quot;执行业务方法doOther&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//项目运行一段时间，又有新的需求：在方法执行后提交事务</span></span><br><span class="line">    System.out.println(<span class="string">&quot;方法执行完毕后，提交事务&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>发现业务逻辑方法中加入了许多和业务逻辑无关的重复代码</li>
<li>现在期望的是，在不改变原有业务逻辑代码的前提下增加功能。</li>
</ul>
<h3 id="1-4-动态代理实现功能的添加"><a href="#1-4-动态代理实现功能的添加" class="headerlink" title="1.4 动态代理实现功能的添加"></a>1.4 动态代理实现功能的添加</h3><ul>
<li><p>动态代理：可以在程序的执行过程中 ， 创建代理对象。<br>通过代理对象执行方法，给目标类的方法增加额外的功能（功能增强）。</p>
</li>
<li><p>jdk动态代理实现步骤:</p>
<ol>
<li>创建目标类，SomeServiceImpl 目标类，给它的doSome，doOther增加输出时间，事务。 </li>
<li>创建InvocationHandler接口的实现类，在这个类实现给目标方法增加功能。</li>
<li>使用jdk中类Proxy，创建代理对象。 实现创建对象的能力。</li>
</ol>
</li>
<li><p>创建MyInvocationHandler实现InvocationHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 目标对象</span></span><br><span class="line">    <span class="keyword">private</span> Object target; <span class="comment">// 最终会是SomeServiceImpl类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyInvocationHandler</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// 通过代理对象执行方法是，会调用执行这个invoke()</span></span><br><span class="line">        Object res = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        SomeServiceTools.doLog();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行目标类的方法，通过Method类实现</span></span><br><span class="line">        res = method.invoke(target, args);</span><br><span class="line"></span><br><span class="line">        SomeServiceTools.doTrans();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 目标方法的执行结果</span></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试：使用Proxy进行代理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInvoke</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用jdk的Proxy创建代理对象</span></span><br><span class="line">    <span class="comment">// 创建目标对象</span></span><br><span class="line">    SomeService target = <span class="keyword">new</span> SomeServiceImpl();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建InvocationHandler</span></span><br><span class="line">    InvocationHandler handler = <span class="keyword">new</span> MyInvocationHandler(target);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用Proxy创建代理</span></span><br><span class="line">    SomeService proxy = (SomeService) Proxy.newProxyInstance(target.getClass().getClassLoader(),</span><br><span class="line">                                                             target.getClass().getInterfaces(), handler);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过代理方法，会调用handler中的invoke()</span></span><br><span class="line">    proxy.doSome();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-5-动态代理的作用"><a href="#1-5-动态代理的作用" class="headerlink" title="1.5 动态代理的作用"></a>1.5 动态代理的作用</h3><ul>
<li>在目标类源代码不改变的情况下，增加功能.</li>
<li>减少代码的重复</li>
<li>专注业务逻辑代码</li>
<li>解耦合，让你的业务功能和日志，事务非业务功能分离。</li>
</ul>
<h2 id="2-AOP"><a href="#2-AOP" class="headerlink" title="2. AOP"></a>2. AOP</h2><h3 id="2-1-AOP简介"><a href="#2-1-AOP简介" class="headerlink" title="2.1 AOP简介"></a>2.1 AOP简介</h3><p>AOP (Aspect Orient Programming)，面向切面编程。面向切面编程是从动态角度考虑程序运行过程。</p>
<p>AOP底层，就是采用动态代理模式实现的。采用了两种代理：JDK 的动态代理，与CGLIB的动态代理。</p>
<p>AOP为Aspect Oriented Programming的缩写，意为：面向切面编程，可通过运行期动态代理实现程序功能的统一维护的一种技术。AOP是Spring框架中的一个重要内容。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p>
<p>面向切面编程，就是将交叉业务逻辑封装成切面，利用AOP容器的功能将切面织入到主业务逻辑中。所谓交叉业务逻辑是指，通用的、与主业务逻辑无关的代码，如安全检查、事务、日志、缓存等。</p>
<p>若不使用AOP，则会出现代码纠缠，即交叉业务逻辑与主业务逻辑混合在一起。这样，会使主业务逻辑变的混杂不清。</p>
<blockquote>
<p>Aop就是动态代理的规范化，把动态代理的实现步骤，方式都定义好了。</p>
<p>让开发人员用一种统一的方式，使用动态代理。</p>
</blockquote>
<h3 id="2-2-理解面向切面编程"><a href="#2-2-理解面向切面编程" class="headerlink" title="2.2 理解面向切面编程"></a>2.2 理解面向切面编程</h3><p>AOP （Aspect Orient Programming）面向切面编程<br>Aspect：切面，给你的目标类增加的功能，就是切面。像上面用的日志，事务都是切面。<br>                切面的特点：一般都是非业务方法，独立使用的。<br>Orient：面向，对着。<br>Programming：编程。</p>
<p>怎么理解面向物面编程?</p>
<ol>
<li>需要在分析项目功能时，找出切面。</li>
<li>合理的安排切面的执行时间（在目标方法前，还是目标方法后）</li>
<li>合理的安排切面执行的位置，在哪个类，哪个方法增加增强功能</li>
</ol>
<h3 id="2-3-一些术语"><a href="#2-3-一些术语" class="headerlink" title="2.3 一些术语"></a>2.3 一些术语</h3><ul>
<li>Aspect：切面，表示增强的功能，就是一堆代码，完成某个一个功能。非业务功能，常见的切面功能有日志，事务，统计信息，参数检查，权限验证。</li>
<li>JoinPoint：连接点 ，连接业务方法和切面的位置。 就某类中的业务方法。</li>
<li>Pointcut：切入点，指多个连接点方法的集合。多个方法。</li>
<li>目标对象：给哪个 类的方法增加功能，这个类就是 目标对象</li>
<li>Advice:通知，邇知表示切面功能执行的时间。</li>
</ul>
<p>说一个切面有三个关键的要素:</p>
<ol>
<li>切面的功能代码，切面干什么</li>
<li>切面的执行位置，使用Pointcut表示切面执行的位置</li>
<li>切面的执行时间，使用Advice表示时间， 在目标方法之前，还是目标方法之后。</li>
</ol>
<h3 id="2-4-AOP的实现"><a href="#2-4-AOP的实现" class="headerlink" title="2.4 AOP的实现"></a>2.4 AOP的实现</h3><ul>
<li><p>aop是一个规范，是动态的一个规范化，一个标准</p>
</li>
<li><p>aop的技术实现框架：</p>
<ol>
<li><p>spring: spring在内部实现了aop规范，能做aop的工作。<br>spring主要在事务处理时使用aop:<br>我们项目开发中很少使用spring的aop实现。因为spring的aop比较笨重。</p>
</li>
<li><p>aspectJ: 一个开源的专门做aop的框架。 spring框架中集成了aspectj框架， 通过spring就能使用aspectj的功能。<br>aspectJ框架实现aop有两种方式:</p>
<ol>
<li>使用xm1的配置文件:配置 全局事务</li>
<li>使用注解，我们在项目中要做aop功能，一般都使用注解，aspectj有5个注解。</li>
</ol>
</li>
</ol>
</li>
</ul>
<h3 id="2-5-aspectJ框架的使用"><a href="#2-5-aspectJ框架的使用" class="headerlink" title="2.5 aspectJ框架的使用"></a>2.5 aspectJ框架的使用</h3><ol>
<li><p>切面的执行时间，这个执行时间在规范中叫Advice（通知，增强）。在aspectj框架中使用注解表示的。也可以使用xml配置文件中的标签。</p>
<ol>
<li>@Before</li>
<li>@AfterReturning</li>
<li>@Around</li>
<li>@AfterThrowing</li>
<li>@After</li>
</ol>
</li>
<li><p>表示切面执行的位置，使用的是切入点表达式。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;execution(访问权限类型（可选） 返回值的数据类型 方法所在的类的全限定名称（可选） 方法名(方法的参数部分) 方法抛出的异常（可选）)&quot;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>切入点表达式要匹配的对象就是目标方法的方法名。所以，execution表达式中明显就是方法的签名。注意，表达式中黑色文字表示可省略部分，各部分间用空格分开。在其中可以使用以下符号:</p>
<ul>
<li>*(星号)：表示0至多个任意字符</li>
<li>..(两个点)：用在方法参数中，表示任意多个参数。用在报名后，表示当前包及其子包路径。</li>
<li>+(加号)：用在类名后，表示当前类及其子类。用在接口后，表示当前接口及其实现类。</li>
</ul>
</li>
<li><p>举例：</p>
<ul>
<li><p><code>execution(public * *(..))</code>指定切入点为：任意公共方法。</p>
</li>
<li><p><code>execution(* set*(..))</code>指定切入点为：任何一个以”set”开始的方法。</p>
</li>
<li><p><code>execution(* com.xyz.service.*.*(..))</code>指定切入点为：定义在service包下任意类的任意方法。</p>
</li>
<li><p><code>execution(* com.xyz.service..*.*(..))</code>指定切入点为：定义在service包及其子包下任意类的任意方法。</p>
</li>
<li><p><code>execution(* *..service.*.*(..))</code>指定所有报下的service子包下所有类（接口）中所有方法为切入点。</p>
</li>
<li><p><code>execution(* *.service.*.*(..))</code>指定只有一级包下的service子包下所有类（接口）中所有方法为切入点。</p>
</li>
</ul>
</li>
<li><p>使用步骤</p>
<ol>
<li><p>新建maven项目</p>
</li>
<li><p>加入依赖</p>
<ol>
<li><p>spring依赖</p>
</li>
<li><p>aspectj依赖</p>
</li>
<li><p>junit单元测试</p>
</li>
</ol>
</li>
<li><p>创建目标类：接口和他的实现类。要做的是给类中的方法增加功能。</p>
</li>
<li><p>创建切面类:普通类</p>
<ol>
<li>在类的上面加入@Aspect</li>
<li>在类中定义方法，方法就是切面要执行的功能代码。<br>在方法的上面加入aspectj中的通知注解，例如Before<br>有需要指定切入点表达式execution()</li>
</ol>
</li>
<li><p>创建spring的配置文件：声明对象，把对象交给容器统一管理<br>声明对象你可以使用注解或者xml配置文件&lt;bean&gt;</p>
<ol>
<li>声明目标对象</li>
<li>声明切面类对象</li>
<li>声明aspectj框架中的自动代理生成器标签。<br>自动代理生成器：用来完成代理对象的自动创建功能的。</li>
</ol>
</li>
<li><p>创建测试类，从spring容器中获取目标对象（实际就是代理对象）。<br>通过代理执行方法， 实现aop的功能增强。</p>
</li>
</ol>
</li>
</ol>
<ul>
<li>pom.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- aspectJ依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>切面类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*@Aspect：是aspectj框架中的注解</span></span><br><span class="line"><span class="comment"> * 	作用：表示当前类是切面类</span></span><br><span class="line"><span class="comment"> *	切面类：是用来给业务方法增加功能的类，在这个类中有切面的功能代码</span></span><br><span class="line"><span class="comment"> *	位置：在类定义的上面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">	<span class="comment">/*定义方法，方法是实现切面功能的。</span></span><br><span class="line"><span class="comment">	 *	方法的定义要求：</span></span><br><span class="line"><span class="comment">	 *		1. 公共方法public</span></span><br><span class="line"><span class="comment">	 *		2. 方法没有返回值</span></span><br><span class="line"><span class="comment">	 *		3. 方法名称自定义</span></span><br><span class="line"><span class="comment">	 * 		4. 方法可以有参数， 也可以没有参数。</span></span><br><span class="line"><span class="comment">	 *			如果有参数，参数不是自定义的，有几个参数类型可以使用。 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myBefore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 就是切面要执行的代码</span></span><br><span class="line">		System.out.println(<span class="string">&quot;前置通知，切面功能：在目标方法之前输出执行时间&quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>applicationContext.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 把对象交给spring容器，有spring容器统一创建，管理对象 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 声明目标对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;someService&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.service.impl.SomeServiceImpl&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明切面类对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.service.aspect.MyAspect&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明自动代理生成器：使用aspectj框架内部的功能，创建你目标对象的代理对象。 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 创建代理对象实在内存中实现的，修改目标对象的内存中的结构。创建为代理对象。 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 所以目标对象就是被修改后的代理对象。 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- aspectj-autoproxy：会把spring容器中的所有目标对象，一次性都生成代理对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    SomeService service = (SomeService)context.getBean(<span class="string">&quot;someService&quot;</span>);</span><br><span class="line">    service.doSome();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 前置通知，切面功能：在目标方法之前输出执行时间Sat Apr 03 16:54:04 CST 2021</span></span><br><span class="line"><span class="comment">// 执行业务方法doSome</span></span><br></pre></td></tr></table></figure>

<h3 id="2-6-指定通知方法中的参数：JoinPoint"><a href="#2-6-指定通知方法中的参数：JoinPoint" class="headerlink" title="2.6 指定通知方法中的参数：JoinPoint"></a>2.6 指定通知方法中的参数：JoinPoint</h3><ul>
<li>JoinPoint：业务方法，要就切面功能的业务方法。</li>
<li>作用是：可以在通知方法中获取方法执行时的信息，例如方法名称，方法的实参。</li>
<li>如果你的切面功能中需要用到方法的信息，就加入JoinPoint</li>
<li>这个JoinPoint参数的值是由框架赋予，必须是第一个位置的参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;execution(public void *..service..*.doSome(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myBefore</span><span class="params">(JoinPoint jp)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取方法的完整定义</span></span><br><span class="line">    System.out.println(<span class="string">&quot;方法的签名 = &quot;</span> + jp.getSignature());</span><br><span class="line">    System.out.println(<span class="string">&quot;方法的名称 = &quot;</span> + jp.getSignature().getName());</span><br><span class="line">    <span class="comment">// 方法的实参</span></span><br><span class="line">    System.out.println(<span class="string">&quot;方法的实参：&quot;</span>);</span><br><span class="line">    Arrays.asList(jp.getArgs()).forEach(System.out::println);</span><br><span class="line">    <span class="comment">// 就是切面要执行的代码</span></span><br><span class="line">    System.out.println(<span class="string">&quot;前置通知，切面功能：在目标方法之前输出执行时间&quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-7-后置通知-AfterReturning"><a href="#2-7-后置通知-AfterReturning" class="headerlink" title="2.7 后置通知 @AfterReturning"></a>2.7 后置通知 @AfterReturning</h3><p>后置通知定义方法，方法是实现切面功能的。</p>
<ul>
<li><p>方法的定义要求:</p>
<ol>
<li>公共方法public</li>
<li>方法没有返回值</li>
<li>方法名称自定义</li>
<li>方法有参数的，推荐是Object，参数名自定义</li>
</ol>
</li>
<li><p>@AfterReturning：后置通知</p>
<ul>
<li><p>属性：</p>
<ul>
<li><p>value：切入点表达式</p>
</li>
<li><p>returning：自定义的变脸，表示目标方法的返回值的。</p>
<p>自定义变量名必须和通知方法的形参名一样</p>
</li>
</ul>
</li>
<li><p>位置：在方法定义的上面</p>
</li>
<li><p>特点：</p>
<ol>
<li>在目标方法之后执行的。</li>
<li>能够获取到目标方法的返回值，可以根据这个返回值做不同的处理功能</li>
<li>可以修改这个返回值</li>
</ol>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SomeServiceImpl.doOther</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">doOther</span><span class="params">(Integer before, Integer after)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> before * <span class="number">10</span> + after;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyAspect.myAfter</span></span><br><span class="line"><span class="comment">// 注意returning的值要与参数变量名一致</span></span><br><span class="line"><span class="meta">@AfterReturning(value = &quot;execution(public Integer *..service..*.doOther(..))&quot;, </span></span><br><span class="line"><span class="meta">                returning = &quot;res&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">(Object res)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// System.out.println(&quot;后置通知，提交事务&quot;);</span></span><br><span class="line">    System.out.println(<span class="string">&quot;后置通知：在目标方法之后执行的，获取的返回值是：&quot;</span> + res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    SomeService service = (SomeService) context.getBean(<span class="string">&quot;someService&quot;</span>);</span><br><span class="line">    Integer sum = service.doOther(<span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    System.out.println(sum);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 后置通知：在目标方法之后执行的，获取的返回值是：45</span></span><br><span class="line"><span class="comment">// 45 </span></span><br></pre></td></tr></table></figure>

<h3 id="2-8-环绕通知-Around"><a href="#2-8-环绕通知-Around" class="headerlink" title="2.8 环绕通知 @Around"></a>2.8 环绕通知 @Around</h3><ul>
<li><p>环绕通知方法的定义格式</p>
<ol>
<li>public</li>
<li>必须有一个返回值，推荐使用Object</li>
<li>方法名称自定义</li>
<li>方法有参数，固定的参数 ProceedingJoinPoint</li>
</ol>
</li>
<li><p>属性：value 切入点表达式</p>
</li>
<li><p>位置：在方法定义的上面</p>
</li>
<li><p>特点：</p>
<ol>
<li>它是功能最强的通知</li>
<li>在目标方法的前后都能增强功能</li>
<li>控制目标方法是否被调用执行</li>
<li>修改原理的目标方法的执行结果，影响最后的调用结果</li>
</ol>
</li>
<li><p>环绕通知，等同于jdk的动态代理。</p>
</li>
<li><p>参数：ProceedingJoinPoint 就等同于Method</p>
</li>
<li><p>作用：执行目标方法的</p>
</li>
<li><p>返回值：就是执行目标方法的执行结果。</p>
</li>
<li><p>经常做事务，在目标方法之前开启事务，执行目标方法，在目标方法之后提交事务</p>
</li>
</ul>
<p>SomeServiceImpl.doFirst</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">doFirst</span><span class="params">(String name, Integer age)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;执行doFirst事务&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Student = &#123;name = &quot;</span> + name + <span class="string">&quot;, age = &quot;</span> + age + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>myAround</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(value=&quot;execution(* *..SomeService.doFirst(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="comment">// 实现环绕通知</span></span><br><span class="line">    Object result = <span class="keyword">null</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;环绕通知：在目标方法之前，输出时间：&quot;</span>+<span class="keyword">new</span> Date());</span><br><span class="line">    <span class="comment">// 1. 目标方法调用</span></span><br><span class="line">    result = pjp.proceed();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;环绕通知：在目标方法之后，提交事务&quot;</span>);</span><br><span class="line">    <span class="comment">// 2. 在目标方法前或者后加入功能</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回目标方法的执行结果</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>test</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAround</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext ctx = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    SomeService service = (SomeService) ctx.getBean(<span class="string">&quot;someService&quot;</span>);</span><br><span class="line">    System.out.println(service.doFirst(<span class="string">&quot;小红&quot;</span>, <span class="number">18</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 环绕通知：在目标方法之前，输出时间：Sat Apr 03 23:08:09 CST 2021</span></span><br><span class="line"><span class="comment">// 执行doFirst事务</span></span><br><span class="line"><span class="comment">// 环绕通知：在目标方法之后，提交事务</span></span><br><span class="line"><span class="comment">// Student = &#123;name = 小红, age = 18&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-9-异常通知-AfterThrowing"><a href="#2-9-异常通知-AfterThrowing" class="headerlink" title="2.9 异常通知 @AfterThrowing"></a>2.9 异常通知 @AfterThrowing</h3><ul>
<li><p>异常通知方法的定义格式</p>
<ol>
<li>public</li>
<li>没有返回值</li>
<li>方法名称自定义</li>
<li>方法可以有一个参数Exception，如果有还有，就是JoinPoint。</li>
</ol>
</li>
<li><p>@AfterThrowing：异常通知</p>
<ul>
<li><p>属性：</p>
<ol>
<li><p>value：切入点表达式</p>
</li>
<li><p>throwing：自定义的变量，表示目标方法抛出的异常对象。</p>
<p>变量名必须和方法的参数名一致</p>
</li>
</ol>
</li>
<li><p>特点</p>
<ol>
<li><p>在目标方法抛出异常时执行的</p>
</li>
<li><p>可以做异常的监控程序，监控目标方法执行时是不是有异常。</p>
<p>如果有异常，可以发送邮件，短信进行通知</p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>SomeServiceImpl.doSecond</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSecond</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">1</span>/<span class="number">0</span>;<span class="comment">// 手动抛出除0异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyAspect.myAfterThrowing</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing(value = &quot;execution(* *..SomeServiceImpl.doSecond(..))&quot;, throwing = &quot;e&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterThrowing</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;异常通知：方法发生异常时，执行：&quot;</span> + e.getMessage());</span><br><span class="line">    <span class="comment">// 发送邮件，短信，通知开发人员</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>test</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAfterThrowing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext ctx = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    SomeService service = (SomeService) ctx.getBean(<span class="string">&quot;someService&quot;</span>);</span><br><span class="line">    service.doSecond();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-10-最终通知-After"><a href="#2-10-最终通知-After" class="headerlink" title="2.10 最终通知 @After"></a>2.10 最终通知 @After</h3><ul>
<li>最终通知方法的定义格式<ol>
<li>public</li>
<li>没有返回值</li>
<li>方法名称自定义</li>
<li>方法没有参数，如果有，就是JoinPoint。</li>
</ol>
</li>
<li>@After：最终通知<ul>
<li>属性：value：切入点表达式</li>
<li>位置：在方法的上面</li>
</ul>
</li>
<li>特点：<ol>
<li>总是会执行</li>
<li>在目标方法之后执行的</li>
</ol>
</li>
</ul>
<p>SomeServiceImpl.doThird</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doThird</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;执行业务逻辑代码&quot;</span>);		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyAspect.myAfter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@After(value = &quot;execution(* *..SomeServiceImpl.doThird(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;执行最终通知&quot;</span>);</span><br><span class="line">    <span class="comment">// 一般是做资源清除工作的</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-11-Pointcut注解"><a href="#2-11-Pointcut注解" class="headerlink" title="2.11 Pointcut注解"></a>2.11 Pointcut注解</h3><ul>
<li>定义和管理切入点，如果你的项目中有多个切入点表达式是重复的，可以复用的。可以使用@Pointcut</li>
<li>属性：value：切入点表达式</li>
<li>位置：在自定义的方法上面</li>
<li>特点：<ul>
<li>当使用@Pointcut定义在一个方法的上面，此时这个方法的名称就是切入点表达式的别名。</li>
<li>其他的通知中，value属性可以使用这个方法名称，代替切入点表达式了</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(value = &quot;execution(* *..SomeServiceImpl.doFirst(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">myPointcut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Around(value = &quot;myPointcut()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="comment">// 实现环绕通知</span></span><br><span class="line">    Object result = <span class="keyword">null</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;环绕通知：在目标方法之前，输出时间：&quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">    <span class="comment">// Arrays.asList(pjp.getArgs()).forEach(System.out::println);</span></span><br><span class="line">    <span class="comment">// 1. 目标方法调用</span></span><br><span class="line">    result = pjp.proceed();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;环绕通知：在目标方法之后，提交事务&quot;</span>);</span><br><span class="line">    <span class="comment">// 2. 在目标方法前或者后加入功能</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回目标方法的执行结果</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="meta">@Around(value = &quot;execution(* *..SomeService.doFirst(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="comment">// 实现环绕通知</span></span><br><span class="line">    Object result = <span class="keyword">null</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;环绕通知：在目标方法之前，输出时间：&quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">    <span class="comment">// Arrays.asList(pjp.getArgs()).forEach(System.out::println);</span></span><br><span class="line">    <span class="comment">// 1. 目标方法调用</span></span><br><span class="line">    result = pjp.proceed();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;环绕通知：在目标方法之后，提交事务&quot;</span>);</span><br><span class="line">    <span class="comment">// 2. 在目标方法前或者后加入功能</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回目标方法的执行结果</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-12-没有接口是CGLIB代理，有接口是JDK动态代理"><a href="#2-12-没有接口是CGLIB代理，有接口是JDK动态代理" class="headerlink" title="2.12 没有接口是CGLIB代理，有接口是JDK动态代理"></a>2.12 没有接口是CGLIB代理，有接口是JDK动态代理</h3><h3 id="2-13-有接口也能使用动态代理。"><a href="#2-13-有接口也能使用动态代理。" class="headerlink" title="2.13 有接口也能使用动态代理。"></a>2.13 有接口也能使用动态代理。</h3><ul>
<li><p>如果你期望目标类有接口，使用cglib代理</p>
</li>
<li><p>修改applicationContext.xml</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- proxy-target-class=&quot;true&quot;</span></span><br><span class="line"><span class="comment">	告诉框架，要使用cglib动态代理 </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Spring整合mybatis"><a href="#Spring整合mybatis" class="headerlink" title="Spring整合mybatis"></a>Spring整合mybatis</h1><h2 id="1-思路"><a href="#1-思路" class="headerlink" title="1. 思路"></a>1. 思路</h2><ul>
<li><p>把mybatis框架和spring集成在一起，像一个框架一样使用。</p>
</li>
<li><p>用的技术是：ioc</p>
</li>
<li><p>为什么ioc：能把mybatis和spring集成在一起，像一个框架，是因为ioc能创建对象。可以把mybatis框架中的对象交给spring统一创建，开发人员从spring中获取对象。开发人员就不要同时面对两个或多个对象了，就面对一个spring。</p>
</li>
<li><p>mybatis使用步骤，对象</p>
<ol>
<li>定义dao接口StudentDao</li>
<li>定义mapper文件StudentDao.xml</li>
<li>定义mybatis的主配置文件mybatis.xml</li>
<li>创建dao的代理对象StudentDao dao = SqlSession.getMapper(StudentDao.class);</li>
</ol>
<p>List&lt;Student&gt; students = dao.selectStudents();</p>
</li>
<li><p>要使用dao对象，需要使用getMapper()方法。怎么能使用getMapper()方法，需要哪些条件？</p>
<ol>
<li>获取SqlSession对象，需要使用SqlSessionFactory的openSession()方法。</li>
<li>创建SqlSessionFactory对象，通过读取mybatis的主配置文件，能创建SqlSessionfactory对象。</li>
</ol>
</li>
<li><p>需要sqlsessionFactory对象，使用Factory能获取Sqlsession ，有了SqlSession就能有dao，目的就是获取dao对象。<br>Factory创建需要读取主配置文件。</p>
</li>
<li><p>主配置文件：</p>
<ol>
<li>数据库信息</li>
<li>mapper文件的位置</li>
</ol>
</li>
<li><p>我们会使用独立的连按池类替换mybatis默认自己带的，把连接池类也交给spring创建。</p>
</li>
<li><p>通过以上的说明，我们需要让spring创建以下对象。</p>
<ol>
<li><p>独立的连接池类的对象，使用 阿里的druid连接池</p>
</li>
<li><p>SqlsessionFactory对象</p>
</li>
<li><p>创建出dao对象</p>
</li>
</ol>
</li>
<li><p>需要学习就是上面三个对象的创建语法，使用xml的bean标签。</p>
</li>
<li><p>步骤</p>
<ol>
<li>新建maven项目</li>
<li>加入maven的依赖<ol>
<li>spring依赖</li>
<li>mybatis依赖</li>
<li>mysql驱动</li>
<li>spring的事务的依赖</li>
<li>mybatis和spring集成的依赖：mybatis官方提供的，用来在spring项目中创建mybatis的sqlsesissonFactory、dao对象的</li>
</ol>
</li>
<li>创建实体类</li>
<li>创建dao接口和mapper文件</li>
<li>创建mybatis主配置文件</li>
<li>创建Service接口和实现类,属性是dao。</li>
<li>创建spring的配置文件：声明mybatis的对象交给spring创建<ol>
<li>数据源</li>
<li>sqlSessionFactory</li>
<li>Dao对象</li>
</ol>
</li>
<li>创建测试类，获取Service对象，通过service调用dao完成数据库的访问</li>
</ol>
</li>
</ul>
<h2 id="2-引入依赖和插件、搭建mybatis运行环境"><a href="#2-引入依赖和插件、搭建mybatis运行环境" class="headerlink" title="2. 引入依赖和插件、搭建mybatis运行环境"></a>2. 引入依赖和插件、搭建mybatis运行环境</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spring核心IOC --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 做Spring事务用到的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- mybatis依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- mybatis和spring集成的依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- mysql驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 阿里巴巴的数据库连接池 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>mybatis的主配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  控制mybatis全局行为  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置mybatis输出日志 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  设置别名  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;ctgu.qiny.entity&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;ctgu.qiny.dao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>创建的Student实体类、StudentDao、StudentDao.xml参考mybatis</li>
</ul>
<h2 id="3-创建Service类"><a href="#3-创建Service类" class="headerlink" title="3. 创建Service类"></a>3. 创建Service类</h2><ul>
<li>StudentService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Student&gt; <span class="title">queryStudent</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>StudentServiceImpl</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceImpl</span> <span class="keyword">implements</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StudentDao studentDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudentDao</span><span class="params">(StudentDao studentDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.studentDao = studentDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addStudent</span><span class="params">(Student student)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentDao.insertStudent(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">queryStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentDao.selectStudents();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-在主配置文件中配置DataSource-和dao对象"><a href="#4-在主配置文件中配置DataSource-和dao对象" class="headerlink" title="4. 在主配置文件中配置DataSource 和dao对象"></a>4. 在主配置文件中配置DataSource 和dao对象</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明数据源DataSource，作用书链接数据库的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis-learning?useSSL=false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  声明的是mybatis中提供的SQLSessionFactoryBean类，这个类内部创建SqlSessionFactory的  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- set注入，把数据流链接池付给了dataSource属性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mybatis主配置文件的位置</span></span><br><span class="line"><span class="comment">                configLocation属性是Resource类型，读取配置文件</span></span><br><span class="line"><span class="comment">                它的赋值，使用value，指定文件的路径，使用classpath:表示文件的位置</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  创建dao对象，使用SqlSession的getMapper(StudentDao.class)</span></span><br><span class="line"><span class="comment">        MapperScannerConfigurer：在内部调用getMapper()生成每个dao接口的代理对象。</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  指定SqlSessionFactory对象的id  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定包名，包名是dao接口所在的包名。</span></span><br><span class="line"><span class="comment">            MapperScannerConfigurer会扫描这个包中的所有接口，</span></span><br><span class="line"><span class="comment">            把每个接口都执行一次getMapper()方法，得到每个接口的dao对象。</span></span><br><span class="line"><span class="comment">            创建好的dao对象放入发哦spring的容器中的。</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ctgu.qiny.dao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-测试"><a href="#5-测试" class="headerlink" title="5. 测试"></a>5. 测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context =</span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    StudentService studentService = (StudentService) context.getBean(<span class="string">&quot;studentService&quot;</span>);</span><br><span class="line">    studentService.queryStudent().forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-使用属性配置文件配置数据库连接信息"><a href="#6-使用属性配置文件配置数据库连接信息" class="headerlink" title="6. 使用属性配置文件配置数据库连接信息"></a>6. 使用属性配置文件配置数据库连接信息</h2><ul>
<li>jdbc.properties</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis-learning?useSSL=false</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改spring的主配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  把数据库的配置信息，写在一个独立的文件，编译修改数据库的配置内容</span></span><br><span class="line"><span class="comment">        让spring支持jdbc.properties文件的位置</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明数据源DataSource，作用书链接数据库的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用属性配置文件中的数据，语法：$&#123;key&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Spring事务"><a href="#Spring事务" class="headerlink" title="Spring事务"></a>Spring事务</h1><ol>
<li><p>什么是事务</p>
<ul>
<li>讲mysql的时候，提出了事务。事务是指一组sql语句的集合，集合中有多条sql语句。可能是insert，update ，select ，delete。我们希望这些多个sql语句都能成功，或者都失败，这些sql语句的执行是一致的，作为个整体执行。</li>
</ul>
</li>
<li><p>在什么时候想到使用事务</p>
<ul>
<li>当我的操作，涉及到多个表，或者是多个sql语句的insert、update、delete。 需要保证这些语句都是成功才能完成我的功能，或者都失败，保证操作是符合要求的。</li>
<li>在java代码中写程序，控制事务，此时事务应该放在哪里呢？</li>
<li>service类的业务方法上， 因为业务方法会调用多个dao方法，执行多个sql语句</li>
</ul>
</li>
<li><p>通常使用JDBC访问数据库，还是mybatis访问数据库怎么处理事务。</p>
<ol>
<li>jdbc访问数据库，处理事务 Connection conn; conn.commit(); conn.rollback();</li>
<li>mybatis访问数据库，处理事务，SqlSession sqlSession; sqlSession.commit(); sqlSession.rollback();</li>
</ol>
</li>
<li><p>3问题中事务的处理方式，有什么不足</p>
<ol>
<li>不同的数据库访问技术，处理事务的对象，方法不同，<br>需要了解不同数据库访问技术使用事务的原理。</li>
<li>掌握多种数据库中事务的处理逻辑。什么时候提交事务，什么时候回滚事务。</li>
<li>处理事务的多种方法。</li>
</ol>
<p>总结：就是多种数据库的访问技术，有不同的事务处理的机制，对象，方法。</p>
</li>
<li><p>怎么解决不足</p>
<ul>
<li>spring提供一致处理事务的统一模型，能使用统一步骤，方式完成多种不同数据库访问技术的事务处理。</li>
<li>使用spring的事务处理机制，可以完成mybatis访问数据库的事务处理</li>
<li>使用spring的事务处理机制，可以完成hibernate访问数据库的事务处理</li>
<li>…</li>
</ul>
</li>
<li><p>处理事务需要怎么做，做什么</p>
<blockquote>
<p>spring处理事务的模型，使用的步骤都是固定的。把事务使用的信息提供给spring就可以了。</p>
</blockquote>
<ol>
<li><p>事务内部提交，回滚事务，使用的事务管理器对象，代替你完成commit，rollback。</p>
<p>事务管理器是一个接口和他的众多实现类.</p>
<p>接口：PlatfornTransactionManager 。定义了事务重要方法commit ，rollback</p>
<p>实现类：spring把每一种数据库访问技术对应的事务处理类都创建好了</p>
<ul>
<li>mybatis访问数据库 — spring创建好的是DataSourceTransaotionManager</li>
<li>hibernate访间数据库 — spring创建的是HibernateTransactionManager</li>
</ul>
<p>怎么使用：你需要告诉spring你用是那种数据库的访问技术，怎么告诉spring呢?<br>声明数据库访问技术对于的事务管理器实现类，在 spring的配置文件中使用&lt;bean&gt;声明就可以了</p>
<p>例如，你要使用mybatis访问数据库，你应该在xn1配置文件中<br>&lt;bean id=”xxx” class=”…DataSourceTransactionManager”&gt;</p>
</li>
<li><p>你的业务方法需要什么样的事务，说明需要事务的类型。<br>说明方法需要的事务：</p>
<ol>
<li><p>事务的隔高级别：有4个值.<br>DEFAULT：采用DB默认的事务隔离级别。Mysql 的默认为REPEATABLE_READ，Oracle默认 为READ _COMMITTED。</p>
<ul>
<li>READ UNCOMAITTED: 读未提交。未解决任何并发问题.</li>
<li>READ COMITTED:读已提交。解决脏读，存在不可重复读与幻读.</li>
<li>REPEATABLE READ: 可重友读.解决脏读。不可重女读，存在幻读</li>
<li>SERIALIZABLE: 串行化.不存在并发问题.</li>
</ul>
</li>
<li><p>事务的超时时间：表示一个方法最长的执行时间，如果方法执行时超过了时间，事务就回滚。<br>单位是秒，整数值， 默认是 -1。</p>
</li>
<li><p>事务的传播行为：控制业务方法是不是有事务的，是什么样的事务的。<br>7个传播行为，表示你的业务方法调用时，事务在方法之间是如果使用的。</p>
<ul>
<li><p>PROPAGATION REQUIRED</p>
</li>
<li><p>PROPAGATION REQUIRES NEW</p>
</li>
<li><p>PROPAGATION SUPPORTS</p>
<blockquote>
<p>以上三个需要掌握的</p>
</blockquote>
</li>
<li><p>PROPAGATION MANDATORY</p>
</li>
<li><p>PROPAGATION NESTED</p>
</li>
<li><p>PROPAGATION NEVER</p>
</li>
<li><p>PROPACATION_NOT_SUPPORTED</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p>提交事务，回滚事务的时机</p>
<ol>
<li><p>当你的业务方法，执行成功，没有异常抛出，当方法执行完毕，spring在方法执行后提交事务。事务管理器commit。</p>
</li>
<li><p>当你的业务方法抛出运行时异常， spring执行回滚，调用事务管理器的rollback。</p>
<p>运行时异常的定义：RuntimeException 和它的子类都是运行时异常，例如NullPointException，NumberFormatException。</p>
</li>
<li><p>当你的业务方法抛出非运行时异常，主要是受查异常和ERROR时，提交事务</p>
<p>受查异常：在你写代码中，必须处理的异常。例如IOException, SQLException</p>
</li>
</ol>
</li>
</ol>
</li>
<li><p>总结spring的事务</p>
<ol>
<li>管理事务的是，事务管理和它的实现类</li>
<li>spring的事务是一个统一模型<ol>
<li>指定要使用的事务管理器实现类，使用&lt;bean&gt;</li>
<li>指定哪些类，哪些方法需要加入事务的功能</li>
<li>指定方法需要的隔离级别，传播行为，超时</li>
</ol>
</li>
</ol>
<blockquote>
<p>你需要告诉spring，你的项目中类信息，方法的名称，方法的事务传播行为。</p>
</blockquote>
</li>
<li><p>spring框架中提供的事务处理方案</p>
<ol>
<li><p>适合中小项目使用的，注解方案。<br>spring框架自己用aop实现给业务方法增加事务的功能，使用@Transactional注解增加事务。<br>@Transactional注解是spring框架自己注解，放在public方法的上面，表示当前方法具有事务。<br>可以给注解的属性赋值，表示具体的隔离级别，传播行为，异常信息等等。</p>
<p>使用@Transactional的步驟：</p>
<ol>
<li><p>需要声明事务管理器对象 <strong>&lt;bean id=”xx” class=”DataSourceTransactionManager”&gt;</strong></p>
</li>
<li><p>开启事务注解去掉，告诉Spring框架，我要使用注解的方式管理事务。</p>
<p>spring使用aop机制，创建@Transactional所在的类型代理对象，给方法加入事务的功能。</p>
<p>spring给事务方法加入事务：</p>
<p>​    在你的业务方法执行之前，先开启事务，在业务方法之后提交或回滚事务，使用aop的环绕通知</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;你要增加的事务功能的业务方法名称&quot;)</span></span><br><span class="line"><span class="function">Objcect <span class="title">myAround</span><span class="params">()</span></span>&#123; </span><br><span class="line">    <span class="comment">// 开启事务，spring给你开启</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      buy(<span class="number">1001</span>, <span class="number">10</span>);</span><br><span class="line">        spring的事务管理.commit();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">        spring的事务管理.rollback();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在你的方法的上面加入@Transactional</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="程序举例环境搭建"><a href="#程序举例环境搭建" class="headerlink" title="程序举例环境搭建"></a>程序举例环境搭建</h2><ul>
<li>举例：购买商品 trans_ sale 项目<br>本例要实现购买商品，模拟用户下订单，向订单表添加销售记录，从商品表减少库存。</li>
</ul>
<h3 id="1-创建数据库、表"><a href="#1-创建数据库、表" class="headerlink" title="1. 创建数据库、表"></a>1. 创建数据库、表</h3><ul>
<li>订单表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sale` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `gid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nums` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<ul>
<li>商品表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `goods` (</span><br><span class="line">  `id` <span class="type">INT</span> (<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">VARCHAR</span> (<span class="number">100</span>),</span><br><span class="line">  `amount` <span class="type">INT</span> (<span class="number">11</span>),</span><br><span class="line">  `price` <span class="type">FLOAT</span> (<span class="number">0</span>),</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE <span class="operator">=</span> INNODB CHARSET <span class="operator">=</span> utf8mb4;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>amount</th>
<th>price</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>笔记本电脑</td>
<td>100</td>
<td>5000</td>
</tr>
<tr>
<td>1002</td>
<td>手机</td>
<td>50</td>
<td>3000</td>
</tr>
</tbody></table>
<h3 id="2-创建项目、实体类"><a href="#2-创建项目、实体类" class="headerlink" title="2. 创建项目、实体类"></a>2. 创建项目、实体类</h3><p>项目的依赖同“spring整合mybatis”</p>
<ul>
<li>Sale、SaleDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sale</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer gid;</span><br><span class="line">    <span class="keyword">private</span> Integer nums;</span><br><span class="line">    <span class="comment">// 省略getter和setter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SaleDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 增加销售记录</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertSale</span><span class="params">(Sale sale)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>SaleDao.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;ctgu.qiny.dao.SaleDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertSale&quot;</span>&gt;</span></span><br><span class="line">        insert into `sale` (`gid`, `nums`) values (#&#123;gid&#125;, #&#123;nums&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Good、GoodDao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Good</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer amount;</span><br><span class="line">    <span class="keyword">private</span> Float price;</span><br><span class="line">    <span class="comment">// 省略getter和setter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GoodDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 更新库存</span></span><br><span class="line">    <span class="comment">// goods表示本次用户购买的商品信息，id，购买数量</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateGood</span><span class="params">(Good goods)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询商品的信息</span></span><br><span class="line">    <span class="function">Good <span class="title">selectGood</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>GoodDao.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;ctgu.qiny.dao.GoodDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateGood&quot;</span>&gt;</span></span><br><span class="line">        update `goods` set `amount` = `amount` - #&#123;amount&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectGood&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;ctgu.qiny.entity.Good&quot;</span>&gt;</span></span><br><span class="line">        select `id`, `name`, `amount`, `price` from `goods` where `id` = #&#123;gid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>mybatis主配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  设置别名  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;ctgu.qiny.entity&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;ctgu.qiny.dao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>NotEnoughException异常类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义的运行时异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotEnoughException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NotEnoughException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NotEnoughException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>BuyGoodService及其实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BuyGoodService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 购买商品的方法，id：购买商品的编号，nums：购买的数量</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">buy</span><span class="params">(Integer id, Integer nums)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyGoodServiceImpl</span> <span class="keyword">implements</span> <span class="title">BuyGoodService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SaleDao saleDao;</span><br><span class="line">    <span class="keyword">private</span> GoodDao goodDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BuyGoodServiceImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">(Integer id, Integer nums)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;==== buy方法的开始 ====&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Sale sale = <span class="keyword">new</span> Sale();</span><br><span class="line">        sale.setGid(id);</span><br><span class="line">        sale.setNums(nums);</span><br><span class="line">        saleDao.insertSale(sale);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新库存</span></span><br><span class="line">        Good good = goodDao.selectGood(id);</span><br><span class="line">        <span class="keyword">if</span> (good == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 商品不存在</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;商品编号[&quot;</span> + id + <span class="string">&quot;]: 商品不存在&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (good.getAmount()&lt;nums)&#123;</span><br><span class="line">            <span class="comment">// 商品库存不足</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NotEnoughException(<span class="string">&quot;商品编号[&quot;</span> + id + <span class="string">&quot;]: 商品库存不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改库存</span></span><br><span class="line">        Good buyGood = <span class="keyword">new</span> Good();</span><br><span class="line">        buyGood.setId(id);</span><br><span class="line">        buyGood.setAmount(nums);</span><br><span class="line">        goodDao.updateGood(buyGood);</span><br><span class="line">        System.out.println(<span class="string">&quot;==== buy方法的完成 ====&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSaleDao</span><span class="params">(SaleDao saleDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.saleDao = saleDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGoodDao</span><span class="params">(GoodDao goodDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.goodDao = goodDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>spring主配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ctgu.qiny.dao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;buyGoodServiceImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ctgu.qiny.service.impl.BuyGoodServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;goodDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;goodDao&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;saleDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;saleDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext context =</span><br><span class="line">            <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    BuyGoodService buyGoodService =</span><br><span class="line">            (BuyGoodService) context.getBean(<span class="string">&quot;buyGoodServiceImpl&quot;</span>);</span><br><span class="line">    buyGoodService.buy(<span class="number">1001</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-使用spring的事务管理机制"><a href="#3-使用spring的事务管理机制" class="headerlink" title="3. 使用spring的事务管理机制"></a>3. 使用spring的事务管理机制</h3><ul>
<li>在spring配置文件中配置事务管理</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  使用spring的事务管理  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  1. 声明事务管理器  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 连接的数据库，指定数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2. 开启事务注解驱动，告诉spring使用注解管理事务，创建代理对象</span></span><br><span class="line"><span class="comment">         transaction-manager：事务管理器对象的id   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>给需要使用事务的方法中添加@Transactional注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*@Transactional(</span></span><br><span class="line"><span class="comment">        propagation = Propagation.REQUIRED,</span></span><br><span class="line"><span class="comment">        isolation = Isolation.DEFAULT,</span></span><br><span class="line"><span class="comment">        readOnly = false,</span></span><br><span class="line"><span class="comment">        rollbackFor = &#123;</span></span><br><span class="line"><span class="comment">                NullPointerException.class, NotEnoughException.class</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">)*/</span></span><br><span class="line"><span class="comment">// 使用的是事务控制的默认值，默认的传播行为是REQUIRED，默认的隔离级别是DEFAULT</span></span><br><span class="line"><span class="comment">// 默认抛出运行时异常，回滚事务</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">(Integer id, Integer nums)</span> </span>&#123;...</span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context =</span><br><span class="line">    <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">BuyGoodService buyGoodService =</span><br><span class="line">    (BuyGoodService) context.getBean(<span class="string">&quot;buyGoodServiceImpl&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;service是代理：&quot;</span>+buyGoodService.getClass().getName());</span><br><span class="line">buyGoodService.buy(<span class="number">1001</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    service是代理：com.sun.proxy.$Proxy18</span></span><br><span class="line"><span class="comment">    ==== buy方法的开始 ====</span></span><br><span class="line"><span class="comment">    ==== buy方法的完成 ====</span></span><br><span class="line"><span class="comment">*/</span>    </span><br><span class="line"><span class="comment">// 当执行buyGoodService.buy(1005, 0);时，会抛出NotEnoughException异常，但sale数据不会增加</span></span><br></pre></td></tr></table></figure>

<h2 id="aspectJ配置aop处理事务"><a href="#aspectJ配置aop处理事务" class="headerlink" title="aspectJ配置aop处理事务"></a>aspectJ配置aop处理事务</h2><p>适合大型项目，有很多的类，方法，需要大量的配置事务，便用aspect框架功能，在spring配置文件中声明类，方法需要的事务。这种方式业务方法和事务配置完全分离。</p>
<p>实现步骤：都是在xml 配置文件中实现。</p>
<ol>
<li>要使用的是aspectj框架，需要加入依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- aspect框架 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>声明事务管理器对象</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;xx&quot;</span> <span class="attr">class</span>=<span class="string">&quot;DataSourceTransactionManager&quot;</span>&gt;</span>...</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>声明方法需要的事务类型（配置方法的事务属性【隔离级别，传播行为，超时】）</li>
<li>配置aop：指定哪些哪类要创建代理</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2. 声明业务方法它的事务属性（隔离级别，传播行为，超过时间） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;transactionInterceptor&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- tx:attributes：配置事务属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- tx:method：给具体方法配置事务属性，method可以有多个，分别给不同的方法设置事务属性</span></span><br><span class="line"><span class="comment">                name：方法名称，  1) 完整的方法名称，不带有包和类</span></span><br><span class="line"><span class="comment">                                 2) 方法可以使用通配符，*表示任意字符</span></span><br><span class="line"><span class="comment">                propagation：传播行为，枚举值</span></span><br><span class="line"><span class="comment">                isolation：隔离行为</span></span><br><span class="line"><span class="comment">                rollback-for：你指定的异常类名，全限定类名。发生异常是一定会回滚。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;buy&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">isolation</span>=<span class="string">&quot;DEFAULT&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">rollback-for</span>=<span class="string">&quot;java.lang.NullPointerException, ctgu.qiny.exce.NotEnoughException&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置aop --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置切入点表达式：指定哪些包中类要用事务</span></span><br><span class="line"><span class="comment">        id：切入点表达式的名称，唯一值</span></span><br><span class="line"><span class="comment">        expression：切入点表达式，指定哪些类要使用事务，aspectJ会创建代理对象。            </span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;servicePointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *..service..*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置增强器： 关联advice和pointcut</span></span><br><span class="line"><span class="comment">            advice-ref：通知，上面tx:advice那里的配置</span></span><br><span class="line"><span class="comment">            pointcut-ref：切入点表达式的id</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;transactionInterceptor&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;servicePointcut&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="复习"><a href="#复习" class="headerlink" title="复习"></a>复习</h2><ul>
<li><p>spring</p>
<ul>
<li><p>什么是spring</p>
<ul>
<li>是一个框架，核心技术是IOC和AOP，实现解耦合。</li>
<li>是一个容器，容器中存放的是java对象，需要的是把对象放入到容器中。</li>
</ul>
</li>
<li><p>怎么使用spring？</p>
<ul>
<li>把项目中用的对象放入到容器中</li>
<li>让容器完成对象的创建，对象之间关系的管理（属性赋值）。</li>
<li>我们在程序中从容器中获取要使用的对象。</li>
</ul>
</li>
<li><p>什么样的对象放入容器中</p>
<ul>
<li>dao类、service类、controller类、工具类。<ol>
<li>使用xml配置文件，&lt;bean&gt;。</li>
<li>使用注解。</li>
</ol>
</li>
<li>spring中的对象默认都是单例的，在容器中这个名称的对象只有一个。</li>
</ul>
</li>
<li><p>不放入到spring容器中的对象有哪些？</p>
<ul>
<li>实体类对象，实体类数据是来自数据库的。</li>
<li>servlet、listener、filter这些对象应该交给tomcat进行管理。</li>
</ul>
</li>
<li><p>使用spring框架的步骤：</p>
<ol>
<li>加入依赖</li>
<li>创建类：接口+实现类 | 没有接口的类</li>
<li>创建spring的配置文件，使用&lt;bean&gt;声明对象</li>
<li>.我们使用容器中的对象，通过ApplicationContext接口和他的实现类ClassssPathXmlApplcactionContext的getBean方法</li>
</ol>
</li>
<li><p>核心技术</p>
<ul>
<li><p>IOC：控制反转</p>
<ul>
<li>是一个理论、思想、概念：指导开发人员在容器中，代码之外管理对象，给属性赋值，管理依赖。</li>
<li>IOC的技术实现使用的是DI（依赖注入）：开发人员在项目中只需要提供对象的名称，对象的创建、查找赋值等都由容器内部实现。</li>
<li>spring使用的是DI的技术，底层使用的是反射机制。</li>
<li>给属性赋值<ul>
<li>set注入：: spring调用类的set方法实现属性赋值。<ul>
<li>简单类型的set注入：property-name-value</li>
<li>引用类型的set注入：property-name-ref</li>
</ul>
</li>
<li>构造往入: spring调用有参数构适方法。<ol>
<li>&lt;constructor-arg&gt;的name属性。name表示构造方法的形参名。</li>
<li>&lt;constructor-arg&gt;的index属性。name表示构造方法的形参的位置，从0开始。</li>
</ol>
</li>
<li>自动注入：由spring根据某些规则，给引用类型完成赋值。常用的有byName和byType<ol>
<li>byName：按名称注入，java类中引用类型的属性名和spring容器中bean的[id] -样,数据类型-样。这样的bean赋值给引用类型</li>
<li>byType：按类型注入，java类中引用类型的是数据类型和spring容器中bean的class是同源关系的，这样的bean能够赋值给引用类型</li>
</ol>
</li>
</ul>
</li>
<li>常用注解<ol>
<li>@Component 创建对象</li>
<li>@Repository 创建dao对象</li>
<li>@Service 创建Service对象，处理业务逻辑的，可以有事务功能。</li>
<li>@Controller创建控制器对象，接收请求，显示处理结果的。</li>
<li>@Value 简单类型的属性赋值</li>
<li>@Autowired Spring框架中引用类型的赋值注解，支持byName，默认是byType。</li>
<li>@Resource jdk中的注解，使用自动注入给引用类型赋值。支持byName、byType。默认是byName。</li>
<li>注解的使用步骤<ol>
<li>加入依赖 spring-context；间接加入了spring-aop</li>
<li>在类中加入注解</li>
<li>在spring的配置文件中，加入组件扫描器的标签&lt;context:component-scan base-package=”包名”&gt;</li>
</ol>
</li>
</ol>
</li>
<li>IOC能实现解耦合<ul>
<li>IOC能够实现业务对象之间的解耦合。例Iservice和dao对象之间的解耦合。</li>
</ul>
</li>
</ul>
</li>
<li><p>AOP：面向切面编程</p>
<ul>
<li><p>底层是动态代理</p>
<ol>
<li><p>jdk动态代理</p>
<ul>
<li><p>使用jdk反射包中的类实现创建代理对象的功能</p>
</li>
<li><p>要求：目标类必须实现接口</p>
</li>
</ul>
</li>
<li><p>2.cglib动态代理</p>
<ul>
<li>使用第三方的工具库,实现代理对象的创建</li>
<li>一个要求：目标类必须能够继承,不能是final</li>
<li>原理：就是继承，子类就是代理</li>
</ul>
</li>
</ol>
</li>
<li><p>aop：看做是动态代理的规范化，把视线动态代理的步骤进行了一个规范，定义</p>
</li>
<li><p>aop作用：</p>
<ol>
<li>在目标类不修改源代码的情况下，增加功能</li>
<li>减少重复的代码</li>
<li>专注业务功能的实现</li>
<li>解耦合：业务功能和日志，事务这些非业务功能的耦合。</li>
</ol>
</li>
<li><p>什么时候考虑使用aop技术</p>
<ol>
<li>当你要给一个系统中存在的类修改功能，但是原有类的功能不完善，但是你还有源代码，使用aop就增加功能</li>
<li>你要给项目中的多个类.增加个相同的功能，使用aop</li>
<li>给业务方法增加事务，日志输出</li>
</ol>
</li>
<li><p>aop的实现框架</p>
<ol>
<li>spring实现了aop，实现方式是接口</li>
<li>aspectj框架<ol>
<li>使用注解可以实现aop的功能</li>
<li>使用xml配置文件中的标签实现aop功能</li>
</ol>
</li>
</ol>
</li>
<li><p>aop中的概念</p>
<ol>
<li>aspect：切面，表示给业务方法增加的功能，一般日志输出，事务，权限检查等是切面</li>
<li>pointcut：切入点，是一个或多个JoinPoint的集合，表示切面功能执行的位置</li>
<li>advice：通知，也叫增强，表示切面执行的时间，在方法前，方法后等等。</li>
</ol>
</li>
<li><p>aspectj框架的使用</p>
<ol>
<li>表示切面的执行时间，使用的通知注解<ol>
<li>@Before：前置通知，在目标方法之前先执行切面的功能。</li>
<li>@AfterReturning：后置通知，在目标方法之后执行的，能够获取到目标方法的返回值。</li>
<li>@Around：环绕通知，在目标方法前和后都能增强功能，控制目标方法的访问，修改返回值</li>
<li>@AfterThrowing：异常通知，在目标方法抛出异常后执行的通知。</li>
<li>@After：最终通知，总是会被执行的代码。</li>
<li>@Pointcut 定义和管理切入点的辅助注解。</li>
<li>代理的使用方式<ol>
<li>如果目标类有接口，框架使用jdk动态代理</li>
<li>如果目标没有接口，默认使用的CGLIB动态代理</li>
<li>有接口也可以强制使用CGLIB动态代理。</li>
</ol>
</li>
</ol>
</li>
<li>表示切面位置的切入点表达式：execution(访问修饰符 返回值 包名.类名.方法名称(方法的参数) 异常)</li>
</ol>
</li>
</ul>
</li>
<li><p>spring整合mybatis</p>
<ul>
<li>整合的想法：使用spring的ioc核心技术，把mybatis框架中使用的对象交给spring统一创建和管理。spring是容器，存放你项目中要使用的各种对象，例如Service对象，Dao对象，工具类等等。</li>
</ul>
</li>
<li><p>交给spring的mybatis对象</p>
<ol>
<li>数据源DataSource，使用阿里公司的Druid连接池</li>
<li>SqlSessionFactory对象，使用的SqlSessionFactoryBean在内部创建的SqlSessionFactory</li>
<li>Dao代理对象，使用的MapperScanConfigure，在这个类的内部，调用getMapper，创建接口的Dao对象。</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>John Doe</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://example.com/2021/04/11/SSM02-Spring/">http://example.com/2021/04/11/SSM02-Spring/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/SSM/"># SSM</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2021/04/11/SSM03-SpringMVC/">SpringMVC</a>
            
            
            <a class="next" rel="next" href="/2021/04/11/SSM01-MyBatis/">MyBatis</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© John Doe | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
